<!DOCTYPE html>
<html>

<head>
  <title>NationHub</title>
  <link rel="icon" type="image/png" href="/favicon-32x32.png">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }

    table th,
    table td {
      text-align: left;
      overflow: hidden;
      padding: 7px;
    }

    table tr:first-child {
      background-color: #525252;
      color: white;
    }

    table tr:not(:first-child) {
      transition: transform 0.3s ease;
    }

    table tr:not(:first-child):hover,
    tr.selected {
      cursor: pointer;
      transform: scale(1.1);
    }

    table tr:first-child th:first-child {
      border-top-left-radius: 6px;
    }

    table tr:first-child th:last-child {
      border-top-right-radius: 6px;
    }

    table tr:last-child td:first-child {
      border-bottom-left-radius: 10px;
    }

    table tr:last-child td:last-child {
      border-bottom-right-radius: 10px;
    }

    table tr:not(:first-child):nth-child(odd) {
      background-color: #f8f8f8;
    }

    table tr:nth-child(even) {
      background-color: #e6e6e6;
    }

    .table-container {
      margin-left: 5%;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      border: 2px solid #333;
      width: 25%;
    }

    body {
      font-family: 'Roboto Mono', monospace;
      background-color: #d1d1d1;
    }

    h1 {
      display: flex;
      align-items: center;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      background-color: #f2f2f2;
      border-radius: 10px;
      border: 2px solid #333;
      position: relative;
      z-index: 999;
    }

    .logo {
      color: rgb(28, 155, 11);
      font-size: 48px;
      cursor: pointer;
    }

    .header {
      font-size: 36px;
      cursor: pointer;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.699);
      z-index: 998;
      display: none;
    }

    .dark-mode-icon {
      font-size: 36px;
      margin-right: 64px;
      cursor: pointer;
      position: fixed;
      right: 10px;
    }

    .dark-mode {
      body {
        background-color: #242424;
      }
    }

    .light-mode {
      body {
        background-color: #e6e6e6;
      }
    }

    .settings {
      font-size: 48px;
      margin-right: 5px;
      cursor: pointer;
      position: fixed;
      right: 10px;
    }

    .settings-title {
      margin-top: 1px;
      font-size: 36px;
    }

    .toggle-label {
      display: flex;
      align-items: center;
    }

    .toggle-icon {
      font-size: 24px;
      margin-left: 5px;
      vertical-align: middle;
      cursor: pointer;
    }

    #settings-window {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 999;
      background-color: #f2f2f2;
      padding: 20px;
      padding-right: 50px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      border: 2px solid #333;
      font-size: 18px;
    }

    .country-card {
      position: fixed;
      top: 50%;
      left: 75%;
      transform: translate(-50%, -50%);
      line-height: 1;
      background-color: #f2f2f2;
      padding: 20px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      border: 2px solid #333;
    }

    .country-card h2 {
      margin-top: 0;
    }

    .neighboring-country-icon {
      cursor: pointer;
    }

    .pagination {
      position: fixed;
      bottom: 20px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
    }

    .pagination-container {
      flex-wrap: wrap;
      display: flex;
      justify-content: center;
    }

    .pagination button {
      margin: 0 5px;
      padding: 5px 10px;
      background-color: #f2f2f2;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .pagination button.active {
      background-color: #525252;
      color: white;
    }

    .flag-column {
      width: 5%;
    }

    .country-column {
      width: 90%;
    }

    .country-column::after {
      content: '';
      display: inline-block;
      height: 100%;
      vertical-align: middle;
    }

    .country-column span {
      display: inline-block;
      vertical-align: middle;
    }

    .region-column {
      width: 5%;
    }

    .sort-button {
      border: none;
      color: white;
      background: none;
      padding: 0;
      cursor: pointer;
    }

    .sort-button span {
      display: inline-block;
      overflow: hidden;
      background-repeat: no-repeat;
      background-position: center;
    }

    .sort-icon {
      transform: rotate(270deg);
    }

    #expand-icon,
    #expand-icon-less {
      font-size: 24px;
      cursor: pointer;
    }

    .flag-coat {
      display: flex;
      align-items: center;
    }

    .flag-coat img {
      height: 120px;
    }

    .flag-coat img:first-child {
      margin-right: 50px;
    }

    .close-icon {
      font-size: 24px;
      position: absolute;
      top: 1px;
      right: 1px;
      cursor: pointer;
    }

    .gdp-growth {
      font-weight: bold;
    }

    .gdp-growth.positive {
      color: green;
    }

    .gdp-growth.negative {
      color: red;
    }

    .loader {
      display: inline-block;
      width: 30px;
      height: 30px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #525252;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    @media (min-height: calc(100vw + 250px)) {
      .table-container {
        width: 90%;
      }

      #settings-window {
        font-size: calc(18px + (100vh - 100vw) / 100);
      }

      .toggle-icon,
      .close-icon,
      #expand-icon {
        font-size: calc(24px + (100vh - 100vw) / 100);
      }

      .country-card p {
        margin-bottom: 0;
      }

      .country-card {
        top: auto;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
      }

      .pagination button {
        font-size: calc(16px + (100vh - 100vw) / 100);
        padding: 5px 10px;
      }
    }
  </style>
</head>

<body>
  <h1>
    <span class="material-symbols-outlined logo" onclick="location.reload()">public</span>
    <span class="header" onclick="location.reload()">NationHub</span>
    <span class="material-symbols-outlined settings" onclick="showSettingsWindow()">settings</span>
    <span id="dark-mode-toggle" class="material-symbols-outlined dark-mode-icon"
      onclick="toggleDarkMode()">dark_mode</span>
    <!-- <span class="material-symbols-outlined">
      light_mode
      </span> -->
  </h1>
  <div class="table-container">
    <table id="countries-table">
      <tr>
        <th class="flag-column"></th>
        <th class="country-column">
          <span>Country</span>
          <button class="sort-button" onclick="sortTable()">
            <span id="sort-symbol" class="material-symbols-outlined sort-icon">switch_right</span>
          </button>
        </th>
        <th class="region-column">Region</th>
      </tr>
    </table>

    <div class="overlay"></div>
    <div id="settings-window">
      <h2 class="settings-title">Settings</h2>
      <div class="toggle-container">
        <strong>Open Big Card by Default:</strong>
        <span class="material-symbols-outlined toggle-icon">toggle_on</span>
        <div class="toggle-switch">
          <input type="checkbox" id="big-card-toggle" hidden>
        </div>
      </div>
      <span class="material-symbols-outlined close-icon ">close</span>
    </div>

    <div class="pagination">
      <div class="pagination-container"></div>
    </div>

    <script>
      let sortOrder = 'asc';
      let currentPage = 1;
      let totalPages = 1;
      let independentCountries = [];
      let countriesPerPage = calculateCountriesPerPage();
      function calculateCountriesPerPage() {
        const h1Element = document.querySelector('h1');
        const paginationElement = document.querySelector('.pagination');
        const h1Rect = h1Element.getBoundingClientRect();
        const paginationRect = paginationElement.getBoundingClientRect();
        const distanceToButtons = paginationRect.top - (h1Rect.top + h1Rect.height);
        const heightDifference = window.innerHeight - window.innerWidth;
        if (heightDifference >= 250) {
          const screenHeight = window.innerHeight;
          const distanceToCenter = screenHeight / 2 - (h1Rect.top + h1Rect.height);
          const fontSize = 16 + heightDifference / 100;
          document.body.style.fontSize = fontSize + 'px';
          return Math.floor(distanceToCenter / 58);
        } else {
          document.body.style.fontSize = '16px';
          return Math.floor(distanceToButtons / 42.65);
        }
      }

      window.addEventListener('resize', function () {
        countriesPerPage = calculateCountriesPerPage();
        renderCountriesTable(independentCountries, currentPage);
        renderPagination(Math.ceil(independentCountries.length / countriesPerPage))
      });

      function fetchCountries() {
        fetch('https://restcountries.com/v3.1/all')
          .then(response => response.json())
          .then(data => {
            independentCountries = data.filter(country => country.independent);
            independentCountries.sort((a, b) => a.name.common.localeCompare(b.name.common));
            totalPages = Math.ceil(independentCountries.length / countriesPerPage);
            currentPage = 1;
            renderPagination(totalPages);
            if (currentPage === 1) {
              renderCountriesTable(independentCountries, currentPage);
            }
          })
          .catch(error => console.log('Error:', error));
      }

      function renderPagination(totalPages) {
        const paginationContainer = document.querySelector('.pagination-container');
        paginationContainer.innerHTML = '';
        for (let i = 1; i <= totalPages; i++) {
          const button = document.createElement('button');
          button.textContent = i;
          button.addEventListener('click', () => setCurrentPage(i));
          if (i === currentPage) {
            button.classList.add('active');
          }
          paginationContainer.appendChild(button);
        }
      }

      function renderCountriesTable(countries, currentPage) {
        const startIndex = (currentPage - 1) * countriesPerPage;
        const countriesTable = document.getElementById('countries-table');
        countriesTable.innerHTML = `
          <tr>
            <th class="flag-column"></th>
            <th class="country-column">
              <span>Country</span>
              <button class="sort-button" onclick="sortTable()">
                <span id="sort-symbol" class="material-symbols-outlined sort-icon">switch_right</span>
              </button>
            </th>
            <th class="region-column">Region</th>
          </tr>`;
        countries.slice(startIndex, startIndex + countriesPerPage).forEach(country => {
          const countryName = country.name.common;
          const countryRegion = country.region || 'N/A';
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><img src="https://flagcdn.com/24x18/${getCountryCode(country)}.png" alt="${countryName} Flag"></td>
            <td>${countryName}</td>
            <td>${countryRegion}</td>`;
          row.addEventListener('click', () => bigCardToggle.checked ? showExpandedCountryInfo(row, country) : showCountryInfo(row, country));
          countriesTable.appendChild(row);
        });
      }

      function setCurrentPage(page) {
        currentPage = page;
        renderPagination(totalPages);
        renderCountriesTable(independentCountries, currentPage);
      }

      let openCountryRow = null;

      function showExpandedCountryInfo(row, country) {
        hideCountryInfo();
        const countryCard = document.createElement('div');
        countryCard.classList.add('country-card');
        countryCard.innerHTML = '<div class="loader"></div>';
        const apiUrl = `https://api.api-ninjas.com/v1/country?name=${getCountryCode(country)}`;
        const cachedData = localStorage.getItem(apiUrl);
        if (cachedData) {
          const data = JSON.parse(cachedData);
          renderCountryInfo(data);
        } else {
          fetch(apiUrl, {
            headers: {
              'X-Api-Key': 'W+OQ/iBAPzIQYLIRvdQgVQ==ixnCBWtlJHxmXrMv'
            }
          })
            .then(response => response.json())
            .then(data => {
              renderCountryInfo(data);
              localStorage.setItem(apiUrl, JSON.stringify(data));
            })
            .catch(error => handleError(error, countryCard));
        }

        function renderCountryInfo(data) {
          const countryData = data[0];
          const gdp = countryData.gdp || 'N/A';
          const gdpGrowth = countryData.gdp_growth || 'N/A';
          const gdpPerCapita = countryData.gdp_per_capita || 'N/A';
          const territory = countryData.surface_area || 'N/A';
          const currencyCode = getCurrencyCode(country.currencies);
          const exchangeUrl = `https://api.api-ninjas.com/v1/convertcurrency?have=${currencyCode}&want=USD&amount=1`;
          fetch(exchangeUrl)
            .then(response => response.json())
            .then(data => {
              const exchangeRate = data.new_amount;
              const currencyDisplay = `${currencyCode} (${exchangeRate.toFixed(2)} USD)`;
              countryCard.innerHTML = `
                <span class ="flag-coat">
                  <img src="https://flagcdn.com/h120/${getCountryCode(country)}.png" height="120" width="190" alt="${country.name.common} Flag">
                  <img src="https://mainfacts.com/media/images/coats_of_arms/${getCountryCode(country)}.svg" alt="${country.name.common} Coat">
                </span>
                <span class="material-symbols-outlined close-icon">close</span>
                <h2>${country.name.common}</h2>
                <p><strong>Capital:</strong> ${country.capital}</p>
                <p><strong>Language:</strong> ${country.languages[Object.keys(country.languages)[0]]}</p>
                <p><strong>Currency:</strong> ${currencyDisplay}</p>
                <p><strong>GDP:</strong> $${(gdp / 1000).toFixed(2)}b <i class="fas fa-dollar-sign"></i></p>
                <p><strong>GDP Per Capita:</strong> $${gdpPerCapita} <i class="fas fa-dollar-sign"></i></p>
                <p><strong>GDP Growth:</strong> <span class="gdp-growth ${gdpGrowth > 0 ? 'positive' : 'negative'}">${gdpGrowth}% ${gdpGrowth > 0 ? '&#8593;' : '&#8595;'}</span></p>
                <p><strong>Population:</strong> ${country.population.toLocaleString()}</p>
                <p><strong>Territory:</strong> ${territory} km<sup>2</sup></p>
                <p><strong>Region:</strong> ${country.region}/${country.subregion}</p>
                <p><strong>Neighboring Countries:</strong> ${getNeighboringCountries(country)}</p>
                <span id="expand-icon-less" class="material-symbols-outlined">expand_less</span>`;
              const closeIcon = countryCard.querySelector('.close-icon');
              closeIcon?.addEventListener('click', () => hideCountryInfo());
              const expandIcon = document.getElementById('expand-icon-less');
              expandIcon?.addEventListener('click', () => showCountryInfo(row, country));
            })
            .catch(error => handleError(error, countryCard));
        }
        document.body.appendChild(countryCard);
        openCountryRow = {
          rowElement: null,
          countryCard: countryCard
        };
      }

      function showCountryInfo(row, country) {
        if (openCountryRow && openCountryRow.rowElement === row) {
          hideCountryInfo();
        } else {
          hideCountryInfo();
          const countryCard = document.createElement('div');
          countryCard.classList.add('country-card');
          countryCard.innerHTML = `
            <img src="https://flagcdn.com/h120/${getCountryCode(country)}.png" height="120" width="190" alt="${country.name.common} Flag">
            <span class="material-symbols-outlined close-icon">close</span>
            <h2>${country.name.common}</h2>
            <p><strong>Capital:</strong> ${country.capital}</p>
            <p><strong>Language:</strong> ${country.languages[Object.keys(country.languages)[0]]}</p>
            <p><strong>Population:</strong> ${country.population.toLocaleString()}</p>
            <span id="expand-icon" class="material-symbols-outlined">expand_more</span>`;
          row.classList.add('selected');
          document.body.appendChild(countryCard);
          openCountryRow = {
            rowElement: row,
            countryCard: countryCard
          };
          const closeIcon = countryCard.querySelector('.close-icon');
          closeIcon?.addEventListener('click', () => hideCountryInfo());
          const expandIcon = document.getElementById('expand-icon');
          expandIcon?.addEventListener('click', () => showExpandedCountryInfo(row, country));
        }
      }

      function showNeighboringCountry(countryName) {
        if (!countryName) return;
        const country = independentCountries.find(c => c.name.common === countryName);
        let row = getRowOfCountry(country);
        if (!row) {
          const countryIndex = independentCountries.findIndex(c => c.name.common === country.name.common);
          const page = Math.ceil((countryIndex + 1) / countriesPerPage);
          setCurrentPage(page);
          row = getRowOfCountry(country);
        }
        function getRowOfCountry(country) {
          const countriesTable = document.getElementById('countries-table');
          const rows = countriesTable.getElementsByTagName('tr');
          for (let i = 1; i < rows.length; i++) {
            const currentRow = rows[i];
            const countryName = currentRow.getElementsByTagName('td')[1].textContent.trim();
            if (countryName === country.name.common) {
              return currentRow;
            }
          }
          return null;
        }
        showExpandedCountryInfo(row, country);
      }

      function hideCountryInfo() {
        if (openCountryRow) {
          if (openCountryRow.rowElement) {
            openCountryRow.rowElement.classList.remove('selected');
          }
          if (openCountryRow.countryCard) {
            document.body.removeChild(openCountryRow.countryCard);
          }
          openCountryRow = null;
        }
      }

      function getNeighboringCountries(country) {
        if (country.borders && country.borders.length > 0) {
          const neighboringCountries = country.borders
            .map(border => {
              const neighboringCountry = independentCountries.find(c => c.cca3 === border);
              return neighboringCountry ? `<img class="neighboring-country-icon" src="https://flagcdn.com/24x18/${getCountryCode(neighboringCountry)}.png" alt="${neighboringCountry.name.common} Flag" onclick="showNeighboringCountry('${neighboringCountry.name.common}')"> ${neighboringCountry.name.common}` : '';
            })
            .filter(Boolean);
          return neighboringCountries.join(', ');
        }
        return "Don't Have";
      }


      function getCountryCode(country) {
        return (country.cca2 || country.cca3).toLowerCase();
      }

      function getCurrency(currencies) {
        const currencyKeys = Object.keys(currencies);
        if (currencyKeys.length > 0) {
          const currencyCode = currencyKeys[0];
          const currency = currencies[currencyCode];
          return `${currency.name} (${currencyCode})`;
        }
        return 'N/A';
      }

      function getCurrencyCode(currencies) {
        const currencyKeys = Object.keys(currencies);
        if (currencyKeys.length > 0) {
          const currencyCode = currencyKeys[0];
          return `${currencyCode}`;
        }
        return 'N/A';
      }

      function sortTable() {
        toggleSortOrder();
        independentCountries.reverse();
        renderCountriesTable(independentCountries, currentPage);
        updateSortButton();
      }

      function toggleSortOrder() {
        sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
        const sortSymbol = document.getElementById('sort-symbol');
        sortSymbol.style.transform = `rotate(${sortOrder === 'asc' ? '90deg' : '270deg'})`;
      }

      function updateSortButton() {
        const sortSymbol = document.getElementById('sort-symbol');
        sortSymbol.style.transform = `rotate(${sortOrder === 'asc' ? '90deg' : '270deg'})`;
        const sortButton = document.querySelector('.sort-button');
        sortButton.dataset.sortOrder = sortOrder;
      }

      function toggleDarkMode() {
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const currentIcon = darkModeToggle.textContent;
        if (currentIcon === 'dark_mode') {
          darkModeToggle.textContent = 'light_mode';
          document.body.classList.remove('dark-mode');
          document.body.classList.add('light-mode');
        } else {
          darkModeToggle.textContent = 'dark_mode';
          document.body.classList.remove('light-mode');
          document.body.classList.add('dark-mode');
        }
        localStorage.setItem('darkModeIcon', darkModeToggle.textContent);
      }

      function showSettingsWindow() {
        const overlay = document.querySelector('.overlay');
        const settingsWindow = document.getElementById('settings-window');
        settingsWindow.style.display = 'block';
        overlay.style.display = 'block';
        const closeButton = settingsWindow.querySelector('.close-icon');
        closeButton.addEventListener('click', hideSettingsWindow);
        overlay.addEventListener('click', hideSettingsWindow);
        function hideSettingsWindow() {
          overlay.style.display = 'none';
          settingsWindow.style.display = 'none';
        }
      }

      let bigCardToggle;

      document.addEventListener('DOMContentLoaded', function () {
        toggleSortOrder();
        updateSortButton();
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const savedIcon = localStorage.getItem('darkModeIcon');
        if (savedIcon) {
          darkModeToggle.textContent = savedIcon;
        }
        if (darkModeToggle.textContent === 'dark_mode') {
          document.body.classList.add('dark-mode');
        } else {
          document.body.classList.add('light-mode');
        }
        bigCardToggle = document.getElementById('big-card-toggle');
        const toggleIcon = document.querySelector('.toggle-icon');
        toggleIcon.addEventListener('click', function () {
          bigCardToggle.checked = !bigCardToggle.checked;
          toggleIcon.textContent = bigCardToggle.checked ? 'toggle_on' : 'toggle_off';
          localStorage.setItem('bigCardToggle', bigCardToggle.checked);
        });
        const initialBigCardValue = localStorage.getItem('bigCardToggle');
        if (initialBigCardValue) {
          bigCardToggle.checked = initialBigCardValue === 'true';
        }
        toggleIcon.textContent = bigCardToggle.checked ? 'toggle_on' : 'toggle_off';
        fetchCountries();
      });

      function handleError(error, countryCard) {
        console.log('Error:', error);
        countryCard.innerHTML = 'Failed to fetch country information.';
      }
    </script>
  </div>
</body>

</html>